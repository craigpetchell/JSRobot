<!DOCTYPE html>
<html>
    <head>
		<script type="text/javascript" src="http://www.google.com/jsapi"></script>
		<script type="text/javascript">
			google.load("jquery", "1.3");
		</script>
        <link rel="stylesheet" href="qunit/qunit.css" type="text/css" media="screen" />
        <script type="text/javascript" src="qunit/qunit.js"></script>
		
        <script>
        	$(document).ready(function() {
				var content;
				module('Typing In Textarea', {
					setup: function() { 
		        		content = document.getElementById('content');
						content.value = '';
						content.focus();
					}
				});
		        asyncTest('Simple character', function() {
					robot.type(0x41, false, function() {
						equals(content.value, 'a');
						QUnit.start();
					});
		        });
				
				asyncTest('Converting from character to keycode', function() {
					robot.type('f', false, function() {
						equals(content.value, 'f');
						QUnit.start();
					});
				});
				
				asyncTest('Converting from upper case character to keycode', function() {
					robot.type('Z', false, function() {
						equals(content.value, 'z');
						QUnit.start();
					});
				});
				
				asyncTest('Typing with shift key', function() {
					robot.type('h', true, function() {
						equals(content.value, 'H');
						QUnit.start();
					});
				});
				
				test('Typing non-ascii character is forbidden (use directly key code instead)', function() {
					try {
						robot.type('^', false);
						ok(false, 'Should have thrown exception on invalid character.');
					} catch (e) {
						ok(true, 'Correctly threw exception on invalid character');
					}
				});
				
				asyncTest('Typing enter', function() {
					robot.type('\n', false, function() {
						ok(content.value =='\n' || content.value == '\r\n', 'Expected a line ending');
						QUnit.start();
					});
				});
				
				asyncTest('Typing backspace', function() {
					content.value = 'test';
					content.select();
					robot.type('\b', false, function() {
						equals(content.value, '', 'Should have deleted content');
						QUnit.start();
					});
				});
				
				asyncTest('Typing tab', function() {
					robot.type('\t', false, function() {
						equals(content.value, '', 'Should have moved focus instead of typing in text area');
						equals(document.activeElement, document.getElementById('nextFocus'));
						QUnit.start();
					});
				});
				
				window.robot.onload(function() {
					QUnit.setup();
				});
			});
        </script>
    </head>
    <body>
        <h1 id="qunit-header">Unit tests for text formatting</h1>
		<h2 id="qunit-banner"></h2>
		<div id="qunit-testrunner-toolbar"></div>
		<h2 id="qunit-userAgent"></h2>
		<ol id="qunit-tests"></ol>
		
		<textarea id="content" rows="10" cols="80"></textarea>
		<input type="text" value="Here for focus" id="nextFocus" />
		<script type="text/javascript" language="JavaScript" src="../src/main/js/robot.js"></script>
    </body>
	
</html>
